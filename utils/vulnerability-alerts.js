const lighthouse = require("lighthouse");
const chromeLauncher = require("chrome-launcher");

const vulnerabilityAlerts = {
  launchAndTest: (url, opts, config = null) => {
    return chromeLauncher
      .launch({ chromeFlags: opts.chromeFlags })
      .then(chrome => {
        opts.port = chrome.port;
        return lighthouse(url, opts, config).then(results => {
          return chrome.kill().then(() => results.report);
        });
      });
  }
};

module.exports = vulnerabilityAlerts;
